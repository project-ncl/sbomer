= REST API Nextgen Query Language (created with ANTLR)

This article serves as a guide to the REST API query language for SBOMer. Note that this language is currently in development and is used only by the Nextgen REST API.

== Quick Examples

Here are some examples of valid queries to show how the query language looks like:

* **Find entities with a specific status:**
    `status:NEW`

* **Find entities that do not have a specific status (negation):**
    `-status:ERROR`

* **Find entities with a status of NEW or PROCESSED (IN clause):**
    `status:NEW,PROCESSED`

* **Find entities created after a specific date:**
    `created:>=2022-01-01`

* **Find entities where the reason contains "processed" and the status is NEW (implicit AND):**
    `reason:~processed status:NEW`

* **Sort entities by their creation date (default ascending):**
    `sort:created`

* **Find new entities and sort them by update date descending:**
    `status:NEW sort:updated:desc`

***

## Basic Syntax

The query language is composed of one or more **statements** separated by spaces. There are two types of statements: **terms** for filtering and **sort** for ordering.

----
statement1 statement2 ...
----

### Filtering with Terms

A term is the fundamental part of a filter. It consists of a field, a colon, and a value.

.Syntax
----
field:value
----

* Multiple terms are automatically combined with a logical **AND**.
* Whitespace between statements is ignored by the parser.

### Values

.Values can be provided in several ways:
- **Single Value**: `status:NEW`
- **Comma-Separated List**: To check for multiple possible values (creates an `IN` clause). `status:NEW,PROCESSED`
- **Quoted String**: Use double quotes (`"`) for values containing spaces or special characters. `reason:"processed with errors"`

***

## Filtering In-Depth

### Operators

Operators are used as an optional prefix to the value to specify the type of comparison. If no operator is provided, it defaults to equals.

[cols="1,2,3", options="header"]
|===
| Operator | Description | Example
| (none) | **Equals**: Checks if the field is exactly equal to the value. | `status:NEW`
| `~` | **Contains**: Checks if the field's text includes the value as a substring. | `reason:~processed`
| `>` | **Greater Than**: Checks if the field is greater than the value. | `created:>2024-01-01`
| `<` | **Less Than**: Checks if the field is less than the value. | `finished:<2025-01-01`
| `>=` | **Greater Than or Equal**: Checks if the field is greater than or equal to the value. | `updated:>=2023-05`
| `\<=` | **Less Than or Equal**: Checks if the field is less than or equal to the value. | `created:\<=2023`
|===

### Negation

You can negate any filtering term by prefixing it with a hyphen (`-`). This is equivalent to a "NOT" or "!=" operation.

.Examples of Negation
Find all events where the status is NOT 'ERROR'

`-status:ERROR`

Find all events where the reason does not contain 'success'

`-reason:~success`


***

## Sorting

You can control the order of the results using a sort statement. In case of multiple sort statements, only the last one will take effect, the previous are ignored.

[cols="1,2,3", options="header"]
|===
| Syntax | Description | Example
| `sort:field` | Sorts by `field` in the default **ascending** order. | `sort:created`
| `sort:field:asc` | Explicitly sorts by `field` in **ascending** order. | `sort:status:asc`
| `sort:field:desc` | Explicitly sorts by `field` in **descending** order. | `sort:updated:desc`
|===

***

## Supported Fields

### For entity: Events

The following table lists the fields you can use when querying the `/events` endpoint.

|===
| Field Name | Data Type | Supported Operators | Example Query

| `id`
| String
| `=`, `~`
| `id:E0BBBBB`

| `status`
| Enum
| `=`
| `status:NEW,PROCESSED`

| `created`
| Timestamp
| `=`, `!=`, `>`, `<`, `>=`, `\<=`
| `created:>2025-07-01`

| `updated`
| Timestamp
| `=`, `!=`, `>`, `<`, `>=`, `\<=`
| `updated:<2023-12-25`

| `finished`
| Timestamp
| `=`, `!=`, `>`, `<`, `>=`, `\<=`
| `finished:>=2024`

| `reason`
| String
| `=`, `~`
| `reason:~processed`
|===

#### Supported Enum Values for `status`

The `status` field must be one of the following values: `NEW`, `IGNORED`, `RESOLVING`, `RESOLVED`, `INITIALIZING`, `INITIALIZED`, `PROCESSING`, `PROCESSED`, `ERROR`.

#### Supported Timestamp Formats

Timestamp fields (`created`, `updated`, `finished`) support the following formats. When a timezone is not specified, UTC is assumed. Partial dates are interpreted as the beginning of the period (e.g., `"2023"` becomes `2023-01-01T00:00:00Z`).

|===
| Format | Example

| `yyyy`
| `created:2023`

| `yyyy-MM`
| `updated:>=2023-10`

| `yyyy-MM-dd`
| `finished:\<=2023-10-25`

| ISO 8601
| `created:>"2023-01-01T12:00:00Z"`
|===
